C51 COMPILER V9.56.0.0   PWM                                                               08/28/2020 18:17:17 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE PWM
OBJECT MODULE PLACED IN .\Objects\pwm.obj
COMPILER INVOKED BY: C:\program_list\keil\C51\BIN\C51.EXE ..\hardware\Pwm\pwm.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..
                    -\hardware\DELAY;..\hardware\ADC;..\hardware\Flash;..\hardware\Uart;..\hardware\Key;..\hardware\Pwm;..\hardware\WDT;..\ha
                    -rdware\Timer;..\hardware\LCDdisplay;..\hardware\PID) DEBUG OBJECTEXTEND PRINT(.\Listings\pwm.lst) TABS(2) OBJECT(.\Objec
                    -ts\pwm.obj)

line level    source

   1          #include "pwm.h"
   2          u8 pwm_period = 0;
   3          
   4          void set_pwm(u8 duty)
   5          {
   6   1        u32 tep = (u32)duty*pwm_period/100;
   7   1        PWM3D = tep;
   8   1      }
   9          
  10          void pwm_init(u16 hz)
  11          {
  12   1      //  P3M5 = 0xC2;                        //P35设置为推挽输出
  13   1      //  P2M1 = 0xC2;                        //P21设置为推挽输出
  14   1      //  PWM0_MAP = 0x35;            //PWM0通道映射P35口
  15   1      //  PWM01_MAP = 0x21;           //PWM01通道映射P21口
  16   1      //
  17   1      //  PWM0C = 0x02;           //PWM0高有效，PWM01高有效，时钟32分频 
  18   1      //  PWMM |= 0x10;           //PWM0工作于独立模式
  19   1      //
  20   1      //   PWM0PH = 0x03;           //周期高4位设置为0x03
  21   1      //   PWM0PL = 0xFF;           //周期低8位设置为0xFF
  22   1      //
  23   1      //  PWM0DH = 0x01;            //PWM0高4位占空比0x01
  24   1      //  PWM0DL = 0x55;            //PWM0低8位占空比0x55
  25   1      //  PWM0DTH = 0x01;           //PWM01高4位占空比0x01
  26   1      //  PWM0DTL = 0x55;           //PWM01低8位占空比0x55
  27   1      //  PWMEN |= 0x11;            //使能PWM1以及PWM01
  28   1        P3M5 = 0xC2;                        //P35设置为推挽输出
  29   1        
  30   1        PWM3_MAP = 0x35;          //PWM3映射P35口
  31   1      
  32   1        //16MHZ
  33   1        //周期计算  = 0xFF / (Fosc / PWM分频系数)  PWM3C  
  34   1        //      = 0xFF /(16000000 / 128)      
  35   1        //      = 1/255 /125000
  36   1        //      = 490HZ
  37   1        pwm_period = (31250/hz)-1;      //31250 = 4000000/128
  38   1        PWM3P = pwm_period;         //PWM周期  
  39   1      //  set_pwm(90);
  40   1        PWM3C = 0x97;             //使能PWM3，关闭中断，允许输出，时钟128分频 111
  41   1      }
  42          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     59    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      1    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.56.0.0   PWM                                                               08/28/2020 18:17:17 PAGE 2   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
